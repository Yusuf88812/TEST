{% extends 'quiz/base.html' %}
{% load static i18n %}

{% block content %}
<div class="animate-fade-in">
    <div class="d-flex justify-content-between align-items-center" style="margin-bottom: 2rem;">
        <h1>{% trans "Reyting" %}</h1>
        <a href="{% url 'quiz:home' %}" class="btn btn-secondary">
            <i class="fas fa-home"></i> {% trans "Bosh sahifa" %}
        </a>
    </div>

    <div class="card" style="padding: 0; overflow: hidden;">
        <div style="overflow-x: auto;">
            <table class="leaderboard-table" style="width: 100%; text-align: left; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="width: 80px; text-align: center;">{% trans "O'rin" %}</th>
                        <th>{% trans "Foydalanuvchi" %}</th>
                        <th>{% trans "Modul" %}</th>
                        <th>{% trans "Ball" %}</th>
                        <th>{% trans "Vaqt" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for attempt in top_attempts %}
                    <tr>
                        <td style="text-align: center;">
                            {% if forloop.counter == 1 %}
                            <div class="leaderboard-rank rank-1">1</div>
                            {% elif forloop.counter == 2 %}
                            <div class="leaderboard-rank rank-2">2</div>
                            {% elif forloop.counter == 3 %}
                            <div class="leaderboard-rank rank-3">3</div>
                            {% else %}
                            <div
                                style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; margin: 0 auto; color: var(--text-muted); font-weight: 700;">
                                {{ forloop.counter }}
                            </div>
                            {% endif %}
                        </td>
                        <td>
                            <div class="d-flex align-items-center gap-3" style="padding: 0.5rem 0;">
                                <div
                                    style="width: 32px; height: 32px; background: rgba(99, 102, 241, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--primary); font-size: 0.8rem;">
                                    {{ attempt.user.username|slice:":1"|upper }}
                                </div>
                                <span style="font-weight: 500;">{{ attempt.user.username }}</span>
                            </div>
                        </td>
                        <td>
                            <div style="font-size: 0.9em; color: var(--text-muted);">{{ attempt.module.subject.name }}
                            </div>
                            <div>{{ attempt.module.name }}</div>
                        </td>
                        <td>
                            <span class="badge badge-primary" style="font-size: 1rem;">{{ attempt.score }}</span>
                        </td>
                        <td style="color: var(--text-muted); font-size: 0.9em;">
                            {{ attempt.date_taken|date:"d.m.Y H:i" }}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 3rem;">
                            {% trans "Hozircha natijalar yo'q." %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}